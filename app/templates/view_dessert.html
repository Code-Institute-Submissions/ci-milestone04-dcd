{% extends "base.html" %}

{% block content %}

<h1>
    {% with messages = get_flashed_messages() %}
    {% if messages %}
    {% for message in messages %}
    {{ message }}
    {% endfor %}
    {% endif %}
    {% endwith %}
</h1>


<div class="container">

    {% if session.user|lower == author|lower or session.user|lower == "admin"|lower %}
    <!-- UPDATE and DELETE buttons -->
    <div class="row center-align section">
        <div class="col s12 m6">
            <!-- Update Button -->
            <a class="waves-effect waves-light btn"
                href="{{ url_for('update_dessert', recipe_id=recipe._id, slugUrl=recipe.recipe_slug) }}">UPDATE
                RECIPE</a>
        </div>

        <div class="col s12 m6">
            <!-- Delete Button -->
            <a class="waves-effect waves-light btn modal-trigger red" href="#modal-delete-recipe">DELETE RECIPE</a>
            <div id="modal-delete-recipe" class="modal">
                <div class="modal-content">
                    <h4>CONFIRM DELETION</h4>
                    <h5>Your recipe will be deleted!</h5>
                    <h6>This action cannot be undone.</h6>
                </div>
                <div class="modal-footer">
                    <a class="waves-effect waves-light red btn "
                        href="{{ url_for('delete_dessert', recipe_id=recipe._id) }}">Delete
                        Recipe</a>
                    <a href="#!" class="modal-close waves-effect waves-light btn">Cancel</a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}


    <!-- THE RECIPE -->
    <div class="row card z-depth-2" id="recipe-card">
        <!-- Recipe Image -->
        <div class="col s12 m6 center-align card-image">
            {% if recipe.img_src %}
            <img src="{{ recipe.img_src }}" class="responsive-img" alt="Dessert">
            {% else %}
            <img src="{{ url_for('static', filename='img/no-img.png') }}" class="responsive-img" alt="Dessert">
            {% endif %}
            <span class="card-title purple-text">{{ recipe.dessert_type }}</span>
        </div>

        <!-- Recipe Details -->
        <div class="col s12 m6 center-align">
            <h4><strong>{{ recipe.recipe_name }}</strong></h4>
            <p>Recipe by: <strong class="purple-text">{{ author }}</strong></p>
            <q>{{ recipe.description }}</q>
            <p>Total Time:
                <strong>
                    {% if recipe.total_hrs %}
                    {{ recipe.total_hrs }}h
                    {% endif %}

                    {% if recipe.total_mins %}
                    {{ recipe.total_mins }}m
                    {% endif %}
                </strong>
            </p>
            <p>Last Updated: <strong>{{ recipe.date_updated }}</strong></p>
            <!--<p>Views: {{ recipe.views }}</p>-->
            <div class="card-content">
                {% for allergen in recipe.allergens %}
                <div class="chip red lighten-3 black-text">
                    <img src="{{ url_for('static', filename='img/allergens/'+allergen|lower+'.png') }}"
                        alt="Allergen">{{ allergen }}</div>
                {% endfor %}
            </div>
        </div>
    </div>


    <!-- INGREDIENTS | DIRECTIONS-->
    <div class="row card z-depth-2" id="recipe-card">
        <!-- Ingredients -->
        <div class="col s12 m4">
            <p>Ingredients</p>
            <ul>
                {% for amount,measurement,ingredient in full_ingredient %}
                {% set unit_loop = loop %}
                <li>
                    {{ amount }}

                    {% if measurement == "not applicable" %}
                    {% else %}
                    <strong class="tooltipped" data-position="right"
                        data-tooltip="{{ units[unit_loop.index-1] }}">{{ measurement }}</strong> of
                    {% endif %}

                    {{ ingredient }}
                </li>
                {% endfor %}
            </ul>
        </div>

        <!-- Directions -->
        <div class="col s12 m8">
            <p>Directions</p>
            <ol>
                {% for direction in recipe.directions %}
                <hr>
                <li>{{ direction }}</li>
                {% endfor %}
            </ol>
        </div>
    </div>

</div>

{% endblock %}